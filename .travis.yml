language: go
go_import_path: github.com/kabukky/journey/

gobuild_args: -v --tags $GOTAGS

dist: trusty
        
global:
  - CGO_ENABLED=1
  - GOTAGS=libsqlite3
  
jobs:
  include:
  - stage: test
    go: 1.8
    env:
    - MY_GOARCH=amd64
    before_install:
    - go get github.com/mattn/goveralls
    script: goveralls -service travis-ci
    
  - &build
    stage: build
    env:
      - MY_GOARCH=386
      - MY_GOOS=linux
    script: 
    - go build -v --tags $GOTAGS ./...
    - zip journey-$MY_GOOS-$MY_GOARCH journey content
  
  - <<: *build
    env:
      - MY_GOARCH=arm64
      - MY_GOOS=linux
      - GOCC=aarch64-linux-gnu-gcc
    before_install:
      - sudo apt-get install crossbuild-essential-arm64
